PROOF_HEAD=e7f057b4a031e0273757836b379fa952da5b49b5
PROOF_SCRIPTS_FILES=scripts/ci_proof_commit_binding.ps1
PROOF_SCRIPTS_FILE_SHA256=scripts/ci_proof_commit_binding.ps1:6f587ea8a5c11be7797cabd6ad10df93383c109a3612a89f356f2b3dd65d9eba
PROOF_SCRIPTS_HASH=ce0178bfa8774469ee797cbb450f48bda03bc02d66100de19ea4e5ea96955ab3
=== 6.10 Activity Log Append-Only — Proof Log ===
Date: 2026-03-01T19:44:53.5887511-05:00
Branch: feat/6.10-activity-log-append-only
HEAD: e7f057b4a031e0273757836b379fa952da5b49b5

=== Versions ===
Node: v20.18.1
pwsh: 7.5.4
Supabase CLI: 2.76.11

=== DoD 1 + 3: All policies on activity_log (must be INSERT and SELECT only) ===
activity_log_insert_own|INSERT
activity_log_select_own|SELECT

=== DoD 2: authenticated has no UPDATE or DELETE privilege ===
f|f

=== DoD 4: Trigger objects exist ===
activity_log_no_delete|O
activity_log_no_update|O

=== DoD 4: Deterministic error message — force trigger fire (UPDATE) ===
INSERT 0 1
ERROR:  activity_log_append_only: mutations are not permitted on activity_log
INSERT 0 1
CONTEXT:  PL/pgSQL function activity_log_append_only() line 3 at RAISE

=== DoD 4: Deterministic error message — force trigger fire (DELETE) ===
ERROR:  activity_log_append_only: mutations are not permitted on activity_log
INSERT 0 1
CONTEXT:  PL/pgSQL function activity_log_append_only() line 3 at RAISE
INSERT 0 1

=== DoD 5: pgTAP tests (4 tests: INSERT ok, row exists, UPDATE blocked, DELETE blocked) ===
Connecting to local database...
[REDACTED] .. ok
[REDACTED] ............. ok
[REDACTED] .......... ok
[REDACTED] ............ ok
[REDACTED] ......... ok
[REDACTED] ............ ok
[REDACTED] ................ ok
All tests successful.
Files=7, Tests=57,  1 wallclock secs ( 0.02 usr  0.02 sys +  0.02 cusr  0.03 csys =  0.09 CPU)
Result: PASS

=== DoD 6: REVOKE present in migration ===
-- 1. Revoke UPDATE and DELETE on activity_log from authenticated
REVOKE UPDATE, DELETE ON TABLE public.activity_log FROM authenticated;

=== RESULT ===
6.10 Activity Log Append-Only: PASS
