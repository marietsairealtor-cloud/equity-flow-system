import fs from "node:fs";const y=fs.readFileSync(".github/workflows/ci.yml","utf8");const wf=((/^name:\s*(.+)$/m.exec(y)||[])[1]||"CI").trim();const m=/^\s{2}required:\s*$[\s\S]*?^\s{4}needs:\s*\[([^\]]+)\]/m.exec(y);if(!m) throw new Error("required.needs not found");const ids=m[1].split(",").map(s=>s.trim()).filter(Boolean);const checks=ids.map(id=>{const re=new RegExp("^\\s{2}"+id+":\\s*$([\\s\\S]*?)(?=^\\s{2}[A-Za-z0-9_-]+:\\s*$|\\Z)","m");const b=re.exec(y);if(!b) throw new Error("job not found: "+id);const nm=(/^\s{4}name:\s*(.+)$/m.exec(b[1])||[])[1];return {name:`${wf} / ${(nm||id).trim()}`,type:"github_status",required:true};}).sort((a,b)=>a.name.localeCompare(b.name));fs.writeFileSync("docs/truth/required_checks.json",JSON.stringify({checks},null,2)+"\n","utf8");
